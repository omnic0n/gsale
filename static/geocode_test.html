<!DOCTYPE html>
<html>
<head>
    <title>Geocoding Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #map { height: 400px; width: 100%; border: 1px solid #ccc; margin: 20px 0; }
        .form-group { margin: 10px 0; }
        input { padding: 8px; width: 300px; }
        button { padding: 8px 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Geocoding Test</h1>
    
    <div id="status" class="status info">
        Testing geocoding functionality...
    </div>
    
    <div class="form-group">
        <label>Latitude:</label>
        <input type="text" id="latitude" placeholder="Enter latitude">
    </div>
    
    <div class="form-group">
        <label>Longitude:</label>
        <input type="text" id="longitude" placeholder="Enter longitude">
    </div>
    
    <div class="form-group">
        <label>Address:</label>
        <input type="text" id="address" placeholder="Address will be populated here">
    </div>
    
    <button onclick="testGeocoding()">Test Reverse Geocoding</button>
    <button onclick="getCurrentLocation()">Get Current Location</button>
    
    <div id="map"></div>
    
    <script>
        let geocoder;
        let map;
        
        function initMap() {
            console.log('Initializing map...');
            
            // Initialize geocoder first
            geocoder = new google.maps.Geocoder();
            console.log('Geocoder initialized:', geocoder);
            
            // Initialize map
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 40.7128, lng: -74.0060 },
                zoom: 10,
            });
            
            document.getElementById('status').innerHTML = 'Map and geocoder initialized successfully';
            document.getElementById('status').className = 'status success';
        }
        
        function testGeocoding() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);
            
            if (isNaN(lat) || isNaN(lng)) {
                document.getElementById('status').innerHTML = 'Please enter valid latitude and longitude';
                document.getElementById('status').className = 'status error';
                return;
            }
            
            const location = { lat: lat, lng: lng };
            console.log('Testing geocoding for:', location);
            
            geocoder.geocode({ location: location }, (results, status) => {
                console.log('Geocoding result:', status, results);
                
                if (status === "OK" && results[0]) {
                    document.getElementById('address').value = results[0].formatted_address;
                    document.getElementById('status').innerHTML = 'Geocoding successful!';
                    document.getElementById('status').className = 'status success';
                } else {
                    document.getElementById('status').innerHTML = 'Geocoding failed: ' + status;
                    document.getElementById('status').className = 'status error';
                }
            });
        }
        
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        document.getElementById('latitude').value = lat;
                        document.getElementById('longitude').value = lng;
                        
                        // Test geocoding immediately
                        const location = { lat: lat, lng: lng };
                        geocoder.geocode({ location: location }, (results, status) => {
                            if (status === "OK" && results[0]) {
                                document.getElementById('address').value = results[0].formatted_address;
                                document.getElementById('status').innerHTML = 'Current location detected and geocoded successfully!';
                                document.getElementById('status').className = 'status success';
                            } else {
                                document.getElementById('status').innerHTML = 'Geocoding failed: ' + status;
                                document.getElementById('status').className = 'status error';
                            }
                        });
                    },
                    (error) => {
                        document.getElementById('status').innerHTML = 'Geolocation failed: ' + error.message;
                        document.getElementById('status').className = 'status error';
                    }
                );
            } else {
                document.getElementById('status').innerHTML = 'Geolocation not supported';
                document.getElementById('status').className = 'status error';
            }
        }
        
        // Initialize map when page loads
        window.initMap = initMap;
    </script>
    
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuyTm06xFlfZZI_5nRckq9Vh0d0bblqJY&libraries=places&callback=initMap">
    </script>
</body>
</html> 