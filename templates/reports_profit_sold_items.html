{% extends "layout.html" %}
{% block content %}
<div class="content-section">
    <p class="mb-3">
        <a href="{{ url_for('reports_profit') }}" class="btn btn-outline-secondary btn-sm">&larr; Back to Profit Report</a>
    </p>
    <h4>Sold items for date: {{ group_date }}</h4>
    <p class="text-muted">Items from groups (collections) with purchase date {{ group_date }}.</p>

    <style>
        .content-section .blueTable th:nth-child(1), .content-section .blueTable td:nth-child(1) { min-width: 36px; }
        .content-section .blueTable th:nth-child(2), .content-section .blueTable td:nth-child(2) { min-width: 180px; }
        .content-section .blueTable th:nth-child(3), .content-section .blueTable td:nth-child(3) { min-width: 140px; }
        .content-section .blueTable th:nth-child(4), .content-section .blueTable td:nth-child(4) { min-width: 48px; }
        .content-section .blueTable th:nth-child(5), .content-section .blueTable td:nth-child(5) { min-width: 95px; }
        .content-section .blueTable th:nth-child(6), .content-section .blueTable td:nth-child(6) { min-width: 85px; }
        .content-section .blueTable th:nth-child(7), .content-section .blueTable td:nth-child(7) { min-width: 75px; }
        .content-section .blueTable th:nth-child(8), .content-section .blueTable td:nth-child(8) { min-width: 85px; }
        .content-section .blueTable th:nth-child(9), .content-section .blueTable td:nth-child(9) { min-width: 75px; }
        .content-section .blueTable th:nth-child(10), .content-section .blueTable td:nth-child(10) { min-width: 85px; }
        .content-section .blueTable th:nth-child(11), .content-section .blueTable td:nth-child(11) { min-width: 80px; }
    </style>
    <table class="blueTable">
        <thead>
            <tr>
                <th></th>
                <th>Name</th>
                <th>Group</th>
                <th>eBay</th>
                <th>Sold Date</th>
                <th>Days to Sell</th>
                <th>Gross</th>
                <th>Shipping Fee</th>
                <th>Net</th>
                <th>Returned Fee</th>
                <th>Storage</th>
            </tr>
        </thead>
        <tbody>
            {% set ns = namespace(count=1) %}
            {% for item in items %}
            <tr {% if item['returned'] %}style="background-color: #ffe6e6;"{% endif %}>
                <td>{{ ns.count }}</td>
                <td>
                    <a href="{{ url_for('describe_item', item=item['id']) }}?return_to=group_detail">
                        <b>{{ item['name'] }}</b>
                    </a>
                </td>
                <td>
                    <a href="{{ url_for('group_detail') }}?group_id={{ item['group_id'] }}">{{ item['group_name'] }}</a>
                </td>
                <td>
                    {% if item['ebay_item_id'] %}
                    <a href="https://www.ebay.com/itm/{{ item['ebay_item_id'] }}" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>{{ item['sale_date'] }}</td>
                <td>{{ item['days_to_sell'] }}</td>
                <td>{{ item['gross'] }}</td>
                <td>{{ item['shipping_fee'] }}</td>
                <td>{{ item['net'] }}</td>
                <td>{% if item['returned'] %}{{ item['returned_fee'] or '0.00' }}{% else %}-{% endif %}</td>
                <td>{{ item['storage'] }}</td>
            </tr>
            {% set ns.count = ns.count + 1 %}
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="font-weight: bold; background-color: #e9ecef; color: #495057;">
                <td colspan="6"><strong>SUMMARY TOTALS</strong></td>
                <td><strong>Gross</strong></td>
                <td><strong>Shipping</strong></td>
                <td><strong>Net</strong></td>
                <td><strong>Returns</strong></td>
                <td></td>
            </tr>
            <tr style="font-weight: bold; background-color: #f8f9fa;">
                <td colspan="6"></td>
                <td><strong>{{ items|selectattr('gross')|map(attribute='gross')|sum }}</strong></td>
                <td><strong>{{ items|selectattr('shipping_fee')|map(attribute='shipping_fee')|sum }}</strong></td>
                <td><strong>{{ items|selectattr('net')|map(attribute='net')|sum }}</strong></td>
                <td><strong>{{ items|selectattr('returned_fee')|map(attribute='returned_fee')|sum }}</strong></td>
                <td></td>
            </tr>
            <tr style="font-weight: bold; background-color: #e9ecef;">
                <td colspan="6"><strong>Purchase (this date)</strong></td>
                <td></td>
                <td></td>
                <td><strong>${{ "%.2f"|format(purchase_price|default(0)) }}</strong></td>
                <td></td>
                <td></td>
            </tr>
            <tr style="font-weight: bold; background-color: #f8f9fa;">
                <td colspan="6"><strong>Profit</strong></td>
                <td></td>
                <td></td>
                <td><strong class="{% if (items|selectattr('net')|map(attribute='net')|sum - (purchase_price|default(0))) >= 0 %}text-success{% else %}text-danger{% endif %}">${{ "%.2f"|format((items|selectattr('net')|map(attribute='net')|sum - (purchase_price|default(0)))) }}</strong></td>
                <td></td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    {% if not items %}
    <p class="text-muted">No sold items for this date.</p>
    {% endif %}
</div>
{% endblock content %}
