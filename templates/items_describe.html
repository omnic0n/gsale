<html>
{% extends "layout.html" %}
{% block content %}
<style>
.return-form-container {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
}

.return-fee-input {
    width: 120px !important;
    margin-right: 10px;
    text-align: center;
}

.return-button {
    white-space: nowrap;
    font-weight: 500;
}

.return-help-text {
    color: #6c757d;
    font-size: 0.875rem;
    margin-bottom: 8px;
    text-align: center;
}

.return-section {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    background-color: #f8f9fa;
    margin: 10px 0;
}
</style>
{% if return_to == 'group_detail' %}
<div class="mb-3">
    <a href="{{ url_for('group_detail', group_id=item[0]['group_id']) }}" class="btn btn-outline-secondary">
        ‚Üê Back to Group Detail
    </a>
</div>
{% endif %}
<table class="blueTable">
    <thead>
        <tr>
            <th>Name</th>
            <th>Category</th>
            <th>Purchase Date</th>
            <th>List Date</th>  
            <th>Storage</th>
            <th>Group</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ item[0]['name'] }}</td>
            <td>{{ category['type'] }}</td>
            <td><a href = "/groups/list?date={{ item[0]['purchase_date'] }}">{{ item[0]['purchase_date'] }}</a></td>
            <td>{{ item[0]['list_date'] }}</td>
            <td>{{ item[0]['storage'] }}</td>
            <td><a href = "/groups/detail?group_id={{ item[0]['group_id'] }}">{{ item[0]['group_name'] }}</a></td>
        </tr>
    </tbody>
</table>
<br>

    <form method="POST" action="">
        {{ modify.hidden_tag() }}
    <div class="form-group">
        {{ modify.button(class="btn btn-outline-info") }}
    </div>
    </form>

<table class="blueTable">
    <thead>
        <tr>
            <th>Status</th>
            <th>Price</th>
            <th>Date</th>
            <th>Days to sell</th>
        </tr>
    </thead>
    <tbody>
        {% if item[0]['sold'] %}
        <tr>
            <td>
                {% if item[0]['returned'] %}
                    Returned
                {% else %}
                    Sold
                {% endif %}
            </td>
            <td>{{ sold[0]['net'] }}</td>
            <td><a href = "/items/list?sold_date={{ sold[0]['date'] }}&sold_status=sold">{{ sold[0]['date'] }}</a></td>
            <td>{{ (sold[0]['date'] - item[0]['purchase_date']).days }}</td>
        </tr>
        {% endif %}
    </tbody>
</table>
<br>
<br>
{% if item[0]['sold'] %}
<table class="blueTable">
    <thead>
        <tr>
            <th>Sold Price</th>    
            <th>Shipping Fee</th>
            <th>Net</th>
            {% if item[0]['returned'] %}
            <th>Returned Fee</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ sold[0]['price'] }}</td>
            <td>{{ sold[0]['shipping_fee'] }}</td>
            <td>{{ sold[0]['net'] }}</td>
            {% if item[0]['returned'] %}
            <td>{{ sold[0]['returned_fee'] or '0.00' }}</td>
            {% endif %}
        </tr>
    </tbody>
</table>
{% endif %}

<br>
<br>
    <table width="100%">
        <td align="left">
            <form method="POST" action="">
                {{ availability.hidden_tag() }}
            <div class="form-group">
                {{ availability.button(class="btn btn-outline-info") }}
            </div>
            </form>
        </td>
        {% if not item[0]['sold']%}
        <td>
            <form method="POST" action="">
                {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.button(class="btn btn-outline-info") }}
            </div>
            </form>
        </td>
        {% endif %}
        {% if item[0]['sold'] and not item[0]['returned'] %}
        <td>
            <div class="return-section">
                <div class="return-help-text">Mark item as returned</div>
                <form method="POST" action="{{ url_for('return_item') }}">
                    {{ return_form.hidden_tag() }}
                    <div class="return-form-container">
                        {{ return_form.returned_fee(class="form-control return-fee-input", placeholder="Return Fee") }}
                        {{ return_form.submit(class="btn btn-outline-warning return-button") }}
                    </div>
                </form>
            </div>
        </td>
        {% endif %}
        <td align="right">
            <form method="POST" action="">
                {{ remove.hidden_tag() }}
            <div class="form-group">
                {{ remove.button(class="btn btn-outline-info") }}
            </div>
            </form>
        </td>
    </table>
{% endblock content %}
</html>