{% extends "layout.html" %}
{% block content %}
<div class="content-wrapper">
    <h1>Neighborhood Sales Report</h1>
    <p>Analyze sales performance by neighborhood with scoring system</p>
    
    <form method="POST" class="mb-4">
        <div class="form-group">
            <label for="year_filter">Year Filter:</label>
            <select name="year" id="year_filter" class="form-control" style="width: auto; display: inline-block;">
                {% for year_value, year_label in year_choices %}
                    <option value="{{ year_value }}" {% if year_value == selected_year %}selected{% endif %}>{{ year_label }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary ml-2">Filter</button>
        </div>
    </form>
    
    {% if not neighborhoods %}
    <div class="alert alert-warning mt-3">
        <h4>No Neighborhoods Found</h4>
        <p>No neighborhoods were found. You need to create neighborhoods first in the Settings menu.</p>
        <a href="/settings/neighborhoods" class="btn btn-primary">Manage Neighborhoods</a>
    </div>
    {% else %}
    
    <div class="table-responsive">
        <table class="blueTable">
            <thead>
                <tr>
                    <th>Neighborhood</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Score</th>
                    <th>Total Purchases</th>
                    <th>Total Spent</th>
                    <th>Total Items</th>
                    <th>Items Sold</th>
                    <th>Total Sales</th>
                    <th>Total Profit</th>
                    <th>ROI</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for data in neighborhoods %}
                {% set neighborhood = data.neighborhood %}
                {% set summary = data.summary %}
                <tr>
                    <td>
                        <strong>{{ neighborhood.name }}</strong>
                        {% if neighborhood.description %}
                            <br><small class="text-muted">{{ neighborhood.description }}</small>
                        {% endif %}
                    </td>
                    <td>{{ neighborhood.city or 'N/A' }}</td>
                    <td>{{ neighborhood.state or 'N/A' }}</td>
                    <td>
                        <span class="badge {% if neighborhood.score >= 8 %}badge-success{% elif neighborhood.score >= 6 %}badge-warning{% else %}badge-danger{% endif %}">
                            {{ neighborhood.score }}/10
                        </span>
                    </td>
                    <td>{{ summary.total_purchases if summary else 0 }}</td>
                    <td>${{ "%.2f"|format(summary.total_spent) if summary else 0 }}</td>
                    <td>{{ summary.total_items if summary else 0 }}</td>
                    <td>{{ summary.sold_items if summary else 0 }}</td>
                    <td>${{ "%.2f"|format(summary.total_sales) if summary else 0 }}</td>
                    <td>
                        {% if summary and summary.total_profit >= 0 %}
                            <span style="color: green;">${{ "%.2f"|format(summary.total_profit) }}</span>
                        {% elif summary %}
                            <span style="color: red;">${{ "%.2f"|format(summary.total_profit) }}</span>
                        {% else %}
                            $0.00
                        {% endif %}
                    </td>
                    <td>
                        {% if summary and summary.total_spent > 0 %}
                            {{ "%.1f"|format((summary.total_profit / summary.total_spent) * 100) }}%
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        <a href="/reports/neighborhood/detail/{{ neighborhood.id }}?year={{ selected_year }}" class="btn btn-sm btn-outline-primary">View Details</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% endif %}
</div>

{% endblock content %}
